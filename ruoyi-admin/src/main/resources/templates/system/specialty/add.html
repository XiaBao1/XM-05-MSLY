<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" >
<head>
    <th:block th:include="include :: header('新增我的特产')" />
</head>
<body class="white-bg">
<div class="wrapper wrapper-content animated fadeInRight ibox-content">
    <form class="form-horizontal m" id="form-specialty-add">
        <div class="form-group">
            <label class="col-sm-3 control-label is-required">民宿ID：</label>
            <div class="col-sm-8">
                <input name="houseId" class="form-control" type="text" required>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label is-required">特产名称：</label>
            <div class="col-sm-8">
                <input name="specialtyName" class="form-control" type="text" required>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label is-required">特产描述：</label>
            <div class="col-sm-8">
                <input name="description" class="form-control" type="text" required>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label is-required">特产单价：</label>
            <div class="col-sm-8">
                <input name="price" class="form-control" type="text" required>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label is-required">库存量：</label>
            <div class="col-sm-8">
                <input name="inventory" class="form-control" type="text" required>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label is-required">特产图片：</label>
            <div class="col-sm-8">
                <input name="imageUrl" class="form-control" type="text" id="imageUrl" required>
            </div>
        </div>

        <div class="form-group">
            <div class="col-sm-8 control-label">
                <button class="btn btn-primary" type="button" onclick="uploadIconBtn(this)" id="uploadButton">
                    <i class="fa fa-upload"></i>&nbsp;&nbsp;&nbsp;&nbsp;<span class="bold" id="uploadSpan">上传图片</span>
                </button>
            </div>
        </div>

        <div class="form-group" id="uploadDiv">
            <label class="col-sm-3 control-label">上传图片</label>
            <div class="file-loading">
                <input class="file" type="file" name="specialtyImage" id="fileinput" data-min-file-count="1" data-max-file-count="1" data-theme="fas">
            </div>
        </div>

    </form>
</div>
<th:block th:include="include :: footer" />
<script th:inline="javascript">
    var prefix = ctx + "system/specialty"
    $("#form-specialty-add").validate({
        focusCleanup: true
    });

    function submitHandler() {
        if ($.validate.form()) {
            $.operate.save(prefix + "/add", $('#form-specialty-add').serialize());
        }
    }
</script>


<script>
    /* hide uploadDiv */
    $(function() {
        var div = $("#uploadDiv");
        div.hide();
    });
    /* click the id is uploadIconBtn button to display the id is uploadDiv div*/
    function uploadIconBtn(btn) {
        var $span = $("#uploadSpan");
        var uploadDiv = $("#uploadDiv");
        // console.log($span[0].innerText);
        if ($span[0].innerText == "上传图片") {
            uploadDiv.show();
            $span[0].innerText = "取消上传";
        } else {
            uploadDiv.hide();
            $span[0].innerText = "上传图片";
        }
    }
</script>


<!-- 图片上传 -->
<script type="text/javascript">
    $(function() {
        $("#fileinput").fileinput({
            uploadUrl: '/system/specialty/menuIconUpload',
            maxFileCount: 1,
            maxFileSize: 1024*3,
            allowedFileTypes: 'jpg,png',
            initialPreviewAsData: true,
            overwriteInitial: true,
        }).on("fileuploaded", function (event, data, previewId, index) {
            // 图片上传成功
            var previewImage = $(".file-preview-image")[0]; // 获取预览图片
            // 获取/news/menu/menuIconUpload接口返回的数据。
            var fileStoragePath = data.response.fileStoragePath;
            var genFilename = data.response.genFilename;
            var URL = data.response.savePath;
            console.log(URL);
            console.dir("图片上传成功！URL："+URL);
            // 隐藏不必要的div和按钮
            $("#uploadDiv").hide(); // 隐藏取div
            var $span = $("#uploadSpan");
            $span[0].innerText = "上传图片";
            //$("#uploadButton").hide(); // 隐藏上传按钮
            $.modal.msgSuccess("图片上传成功！"); // 提示框
            //$("#hiddenData").append('<input type="text" value="'+URL+'" name="imageUrl" disabled>'); // 创建一个input存储URL
            document.getElementById("imageUrl").value=URL;
        })
    });
</script>
<th:block th:include="include :: bootstrap-fileinput-js"/>



</body>
</html>